"use strict";const dataResults=document.querySelector(".js-container"),userSearch=document.querySelector(".js-input"),btn=document.querySelector(".js-btn");let films=[],favoriteFilms=[];function setLocalStorage(){localStorage.setItem("favorite",JSON.stringify(favoriteFilms))}function getLocalStorage(){const e=JSON.parse(localStorage.getItem("films"));null!==e?(favoriteFilms=e,paintFilms(),listenFilms()):getServerData()}function getServerData(){fetch(`http://api.tvmaze.com/search/shows?q=${userSearch.value}`).then(e=>e.json()).then(function(e){films=e,paintFilms(),listenFilms()}).catch(function(e){console.log("Error al traer los datos del servidor",e)})}function paintFilms(){let e="";for(let t=0;t<films.length;t++){const i="https://via.placeholder.com/210x295/ffffff/666666/?text=TV";if(e+=-1!==favoriteFilms.findIndex(function(e,i){return e.id===films[t].show.id})?`<li class="js-film-item favorite-film film__item" id=${films[t].show.id} >`:`<li class="js-film-item film__item" id=${films[t].show.id} >`,e+=`<h3 class="js-films-name film__title">${films[t].show.name}</h3>`,null!==films[t].show.image){e+=`<img src="${films[t].show.image.medium}" class="film__image" alt="Imagen de la película">`}else e+=`<img src="${i}" class="film__image" alt="Imagen de la película">`;e+="</li>"}dataResults.innerHTML=e}function toogleFavorites(e){const t=parseInt(e.currentTarget.id),i=favoriteFilms.findIndex(function(e,i){return e.id===t});if(!0===(-1!==i))favoriteFilms.splice(i,1);else for(let e=0;e<films.length;e++)t===films[e].show.id&&favoriteFilms.push(films[e].show);paintFilms(),listenFilms(),paintFavorites(),setLocalStorage(),document.querySelector(".js-eraseall").addEventListener("click",function(){favoriteFilms.splice(0,favoriteFilms.length),setLocalStorage(),paintFilms(),paintFavorites(),listenFilms()})}function paintFavorites(){const e=document.querySelector(".js-paint-favorites");let t="";for(let e=0;e<favoriteFilms.length;e++)t+=`<li class="film-item film__item" id='${favoriteFilms[e].id}'>`,t+=`<h3 class="favTitle film__title">${favoriteFilms[e].name}</h3>`,null===favoriteFilms[e].image?t+='<img src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV" class="film__image" alt="Imagen de la película">':t+=`<img class='item__img film__image' src='${favoriteFilms[e].image.medium}' alt="Imagen de la película"/>`,t+=`<i class="fas fa-trash-alt js-delete film__delete" id='${favoriteFilms[e].id}'></i>`,t+="</li>";t+='<button class="js-eraseall film__delete__all">Borrar todo</button>',e.innerHTML=t,listenDelete()}function handler(e){e.preventDefault(),getServerData()}function listenFilms(){const e=document.querySelectorAll(".js-film-item");for(const t of e)t.addEventListener("click",toogleFavorites)}function listenDelete(){const e=document.querySelectorAll(".js-delete");for(const t of e)t.addEventListener("click",toogleFavorites)}btn.addEventListener("click",handler),getLocalStorage();